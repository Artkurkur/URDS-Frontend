<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Announcements - URDS</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background: #f5f7fa;
        min-height: 100vh;
        padding-left: 110px;
      }

      .sidebar {
        position: fixed;
        left: 20px;
        top: 50%;
        transform: translateY(-50%);
        width: 70px;
        background: white;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px 0;
        gap: 15px;
        z-index: 1000;
        border-radius: 15px;
      }

      .sidebar-item {
        position: relative;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s;
        background: transparent;
      }

      .sidebar-item:hover {
        background: #f1f5f9;
        transform: scale(1.1);
      }

      .sidebar-item.active {
        background: #e0e7ff;
        border: 2px solid #3b82f6;
        box-shadow: 0 2px 8px rgba(59, 130, 246, 0.2);
      }

      .sidebar-item.active:hover {
        background: #c7d2fe;
        transform: scale(1.1);
      }

      .sidebar-icon {
        width: 32px;
        height: 32px;
        object-fit: contain;
        transition: all 0.3s;
      }

      .sidebar-item:not(.active) .sidebar-icon {
        opacity: 0.6;
      }

      .sidebar-item:hover .sidebar-icon {
        opacity: 1;
      }

      .sidebar-item.active .sidebar-icon {
        opacity: 1;
      }

      .notification-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #ef4444;
        color: white;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
        font-weight: bold;
      }

      .page-header {
        background: transparent;
        padding: 20px;
        display: flex;
        align-items: center;
        gap: 20px;
      }

      .back-button {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        padding: 8px;
        border-radius: 8px;
        transition: background 0.3s;
      }

      .back-button:hover {
        background: #f1f5f9;
      }

      .page-title {
        font-size: 24px;
        color: #2c3e50;
        font-weight: 600;
      }

      .search-container {
        margin-left: auto;
        position: relative;
      }

      .search-box {
        padding: 10px 40px 10px 16px;
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        width: 300px;
        font-size: 14px;
      }

      .search-box:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      }

      .search-icon {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #94a3b8;
      }

      .filter-badge {
        background: #ef4444;
        color: white;
        padding: 2px 6px;
        border-radius: 10px;
        font-size: 10px;
        position: absolute;
        top: -8px;
        right: -8px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 30px 20px;
      }

      .filter-section {
        margin-bottom: 25px;
        display: flex;
        gap: 15px;
        align-items: center;
      }

      .filter-label {
        color: #64748b;
        font-size: 14px;
        font-weight: 500;
      }

      .filter-tabs {
        display: flex;
        gap: 10px;
      }

      .filter-tab {
        padding: 8px 20px;
        border: 1px solid #e2e8f0;
        background: white;
        border-radius: 20px;
        cursor: pointer;
        font-size: 14px;
        color: #64748b;
        transition: all 0.3s;
      }

      .filter-tab:hover {
        background: #f8fafc;
      }

      .filter-tab.active {
        background: #3b82f6;
        color: white;
        border-color: #3b82f6;
      }

      .announcements-grid {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .announcement-card {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        transition: all 0.3s;
        position: relative;
        cursor: pointer;
      }

      .announcement-card:hover {
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
        transform: translateY(-2px);
      }

      .card-header {
        padding: 20px 20px 0 20px;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
      }

      .announcement-label {
        background: #3b82f6;
        color: white;
        padding: 6px 14px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        display: inline-block;
      }

      .announcement-label.recent {
        background: #10b981;
      }

      .announcement-label.update {
        background: #f59e0b;
      }

      .announcement-label.previous {
        background: #8b5cf6;
      }

      .announcement-date {
        color: #94a3b8;
        font-size: 12px;
      }

      .card-content {
        padding: 20px;
        display: flex;
        gap: 20px;
      }

      .time-box {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 15px;
        border-radius: 10px;
        min-width: 80px;
        text-align: center;
        color: white;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .time-box.green {
        background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      }

      .time-box.orange {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      }

      .time-box.purple {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      }

      .time-box.yellow {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
      }

      .time-box.blue {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .time-box.red {
        background: linear-gradient(135deg, #f43f5e 0%, #ef4444 100%);
      }

      .time-number {
        font-size: 28px;
        font-weight: bold;
        line-height: 1;
      }

      .time-label {
        font-size: 10px;
        opacity: 0.9;
        margin-top: 4px;
      }

      .announcement-details {
        flex: 1;
      }

      .announcement-title {
        color: #2c3e50;
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 10px;
        line-height: 1.4;
      }

      .announcement-description {
        color: #64748b;
        font-size: 14px;
        line-height: 1.6;
        margin-bottom: 15px;
      }

      .announcement-meta {
        display: flex;
        gap: 20px;
        font-size: 13px;
        color: #94a3b8;
      }

      .meta-item {
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .meta-item span {
        color: #64748b;
      }

      .announcement-image {
        width: 120px;
        height: 120px;
        object-fit: contain;
      }

      .status-indicator {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #10b981;
      }

      .status-indicator.closed {
        background: #ef4444;
      }

      .load-more {
        text-align: center;
        margin-top: 30px;
      }

      .load-more-btn {
        padding: 12px 30px;
        background: white;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        color: #64748b;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
      }

      .load-more-btn:hover {
        background: #f8fafc;
        border-color: #cbd5e1;
      }

      .detail-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
      }

      .detail-modal.show {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .detail-modal-content {
        background: white;
        border-radius: 15px;
        padding: 40px;
        width: 90%;
        max-width: 700px;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        position: relative;
        animation: slideDown 0.3s ease;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-50px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .detail-modal-close {
        position: absolute;
        right: 20px;
        top: 20px;
        background: transparent;
        border: none;
        font-size: 32px;
        color: #94a3b8;
        cursor: pointer;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.3s;
      }

      .detail-modal-close:hover {
        background: #f1f5f9;
        color: #64748b;
      }

      .detail-modal-title {
        font-size: 24px;
        color: #2c3e50;
        margin-bottom: 20px;
        padding-right: 40px;
      }

      .detail-modal-section {
        margin-bottom: 25px;
      }

      .detail-modal-label {
        display: block;
        color: #64748b;
        font-size: 13px;
        font-weight: 600;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .detail-modal-text {
        color: #2c3e50;
        font-size: 15px;
        line-height: 1.6;
      }

      .detail-modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 15px;
        margin-top: 30px;
      }

      .btn-modal-close {
        padding: 12px 30px;
        background: #f1f5f9;
        color: #64748b;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
      }

      .btn-modal-close:hover {
        background: #e2e8f0;
      }

      @media (max-width: 768px) {
        body {
          padding-left: 0;
        }

        .sidebar {
          display: none;
        }

        .search-box {
          width: 200px;
        }

        .card-content {
          flex-direction: column;
        }

        .announcement-image {
          width: 100%;
          height: 150px;
        }
      }
    </style>
  </head>
  <body>
    <div class="sidebar">
      <div class="sidebar-item" data-page="home">
        <img src="images/index.png" alt="Home" class="sidebar-icon" />
      </div>
      <div class="sidebar-item" data-page="lib">
        <img src="images/lib.png" alt="Library" class="sidebar-icon" />
      </div>
      <div class="sidebar-item active" data-page="announcement">
        <img
          src="images/announcement.png"
          alt="Announcements"
          class="sidebar-icon"
        />
        <div class="notification-badge" id="notificationCount">3</div>
      </div>
      <div class="sidebar-item" data-page="course">
        <img src="images/course.png" alt="Courses" class="sidebar-icon" />
      </div>
    </div>

    <div class="page-header">
      <button class="back-button" onclick="goBack()">‚Üê</button>
      <h1 class="page-title">Announcements</h1>
      <div class="search-container">
        <input
          type="text"
          class="search-box"
          placeholder="Search Announcement"
          id="searchBox"
        />
        <span class="search-icon">üîç</span>
        <span class="filter-badge" id="filterCount" style="display: none"
          >0</span
        >
      </div>
    </div>

    <div class="container">
      <div class="filter-section">
        <span class="filter-label">History</span>
        <div class="filter-tabs">
          <button class="filter-tab active" data-filter="all">All</button>
          <button class="filter-tab" data-filter="active">Active</button>
          <button class="filter-tab" data-filter="closed">Closed</button>
          <button class="filter-tab" data-filter="recent">Recent</button>
        </div>
      </div>

      <div class="announcements-grid" id="announcementsGrid">
        <!-- Announcements will be dynamically loaded here -->
      </div>

      <div class="load-more">
        <button class="load-more-btn" onclick="loadMore()">Load More</button>
      </div>
    </div>

    <!-- Detail Modal -->
    <div id="detailModal" class="detail-modal">
      <div class="detail-modal-content">
        <button class="detail-modal-close" id="closeDetailModal">
          &times;
        </button>
        <h2 class="detail-modal-title" id="modalTitle">Announcement Details</h2>

        <div class="detail-modal-section">
          <label class="detail-modal-label">Title</label>
          <p class="detail-modal-text" id="modalTitleText"></p>
        </div>

        <div class="detail-modal-section">
          <label class="detail-modal-label">Description</label>
          <p class="detail-modal-text" id="modalDescription"></p>
        </div>

        <div class="detail-modal-section">
          <label class="detail-modal-label">Date Posted</label>
          <p class="detail-modal-text" id="modalDate"></p>
        </div>

        <div class="detail-modal-section">
          <label class="detail-modal-label">Deadline</label>
          <p class="detail-modal-text" id="modalDeadline"></p>
        </div>

        <div class="detail-modal-section">
          <label class="detail-modal-label">Status</label>
          <p class="detail-modal-text" id="modalStatus"></p>
        </div>

        <div class="detail-modal-actions">
          <button type="button" class="btn-modal-close" onclick="closeModal()">
            Close
          </button>
        </div>
      </div>
    </div>

    <script>
      // Storage key for proposals
      const PROPOSALS_STORAGE_KEY = "urds_proposals";

      // Load proposals from localStorage or use defaults
      function loadProposals() {
        const stored = localStorage.getItem(PROPOSALS_STORAGE_KEY);
        if (stored) {
          return JSON.parse(stored);
        }

        // Default proposals
        return [
          {
            id: 1,
            title: "Research Grants for Academic Year 2024-2025",
            description:
              "The University Research and Development Services (URDS) is now accepting Research Proposals for the Academic Year 2024-2025",
            startDate: "2025-06-15",
            endDate: "2025-08-20",
            status: "active",
            dateCreated: new Date("2025-01-10T17:00:00").toISOString(),
            labelType: "new",
          },
          {
            id: 2,
            title: "Summer Research Initiative 2024",
            description:
              "Special funding opportunity for summer research projects focusing on interdisciplinary collaboration",
            startDate: "2025-10-20",
            endDate: "2025-10-31",
            status: "active",
            dateCreated: new Date("2025-01-09T21:10:00").toISOString(),
            labelType: "recent",
          },
          {
            id: 3,
            title: "Technology Innovation Fund",
            description:
              "Funding for research projects that demonstrate potential for technological innovation and commercial viability",
            startDate: "2025-09-14",
            endDate: "2025-09-20",
            status: "closed",
            dateCreated: new Date("2025-01-08T10:23:00").toISOString(),
            labelType: "update",
          },
        ];
      }

      // Save proposals to localStorage
      function saveProposals(proposals) {
        localStorage.setItem(PROPOSALS_STORAGE_KEY, JSON.stringify(proposals));
      }

      // Generate announcement cards from proposals
      function generateAnnouncementCards() {
        const proposals = loadProposals();
        const grid = document.getElementById("announcementsGrid");
        grid.innerHTML = ""; // Clear existing cards

        proposals.forEach((proposal, index) => {
          const card = createAnnouncementCard(proposal, index);
          grid.appendChild(card);
        });

        updateNotificationCount();
      }

      // Create an announcement card
      function createAnnouncementCard(proposal, index) {
        const card = document.createElement("div");
        card.className = "announcement-card";
        card.dataset.status = proposal.status;
        card.dataset.id = proposal.id;

        const createdDate = new Date(proposal.dateCreated);
        const now = new Date();
        const timeDiff = now - createdDate;
        const hoursDiff = Math.floor(timeDiff / (1000 * 60 * 60));
        const daysDiff = Math.floor(timeDiff / (1000 * 60 * 60 * 24));

        // Determine time display
        let timeNumber = createdDate.toLocaleTimeString("en-US", {
          hour: "2-digit",
          minute: "2-digit",
          hour12: false,
        });
        let timeLabel = "TODAY";
        let timeBoxClass = "green";

        if (daysDiff === 0) {
          timeLabel = "TODAY";
          timeBoxClass = "green";
        } else if (daysDiff === 1) {
          timeLabel = "YESTERDAY";
          timeBoxClass = "orange";
        } else {
          timeLabel = createdDate
            .toLocaleDateString("en-US", { month: "short", day: "numeric" })
            .toUpperCase();
          timeBoxClass = index % 2 === 0 ? "purple" : "blue";
        }

        // Determine label
        let labelText = "New Announcement";
        let labelClass = "";

        if (proposal.labelType === "recent") {
          labelText = "Recent Announcement";
          labelClass = "recent";
        } else if (proposal.labelType === "update") {
          labelText = "Latest Update";
          labelClass = "update";
        } else if (proposal.labelType === "previous") {
          labelText = "Previous Update";
          labelClass = "previous";
        }

        if (proposal.status === "closed") {
          timeBoxClass = "red";
        }

        card.innerHTML = `
          <div class="card-header">
            <span class="announcement-label ${labelClass}">${labelText}</span>
            <span class="announcement-date">${createdDate.toLocaleDateString(
              "en-US",
              { month: "short", day: "numeric", year: "numeric" }
            )}</span>
          </div>
          <div class="card-content">
            <div class="time-box ${timeBoxClass}">
              <div class="time-number">${timeNumber}</div>
              <div class="time-label">${timeLabel}</div>
            </div>
            <div class="announcement-details">
              <h3 class="announcement-title">${proposal.title}</h3>
              <p class="announcement-description">${proposal.description}</p>
              <div class="announcement-meta">
                <div class="meta-item">
                  üìÖ <span>Deadline - ${proposal.endDate}</span>
                </div>
                <div class="meta-item">
                  üìã <span>${
                    proposal.status === "active"
                      ? "Guidelines Available"
                      : "Closed"
                  }</span>
                </div>
              </div>
            </div>
            <img src="images/research.png" alt="Research" class="announcement-image" />
          </div>
          <div class="status-indicator ${
            proposal.status === "closed" ? "closed" : ""
          }"></div>
        `;

        // Add click event
        card.addEventListener("click", function () {
          openDetailModal(this);
        });

        return card;
      }

      // Update notification count
      function updateNotificationCount() {
        const proposals = loadProposals();
        const activeCount = proposals.filter(
          (p) => p.status === "active"
        ).length;
        const notificationBadge = document.getElementById("notificationCount");
        if (notificationBadge) {
          notificationBadge.textContent = activeCount;
        }
      }

      // Sidebar navigation
      document.querySelectorAll(".sidebar-item").forEach((item) => {
        item.addEventListener("click", function () {
          const page = this.dataset.page;
          switch (page) {
            case "home":
              window.location.href = "index.html";
              break;
            case "lib":
              window.location.href = "lib.html";
              break;
            case "announcement":
              // Already on announcements page
              break;
            case "course":
              window.location.href = "course.html";
              break;
          }
        });
      });

      // Get DOM elements
      const filterTabs = document.querySelectorAll(".filter-tab");
      const searchBox = document.getElementById("searchBox");
      const filterCount = document.getElementById("filterCount");
      const detailModal = document.getElementById("detailModal");
      const closeDetailModalBtn = document.getElementById("closeDetailModal");

      // Add event listeners to filter tabs
      filterTabs.forEach((tab) => {
        tab.addEventListener("click", function () {
          filterTabs.forEach((t) => t.classList.remove("active"));
          this.classList.add("active");
          const filterValue = this.dataset.filter;
          filterAnnouncements(filterValue);
        });
      });

      // Filter announcements function
      function filterAnnouncements(filter) {
        const announcementCards =
          document.querySelectorAll(".announcement-card");
        let visibleCount = 0;

        announcementCards.forEach((card) => {
          if (filter === "all") {
            card.style.display = "block";
            visibleCount++;
          } else if (filter === "active" && card.dataset.status === "active") {
            card.style.display = "block";
            visibleCount++;
          } else if (filter === "closed" && card.dataset.status === "closed") {
            card.style.display = "block";
            visibleCount++;
          } else if (filter === "recent") {
            const index = Array.from(announcementCards).indexOf(card);
            if (index < 3) {
              card.style.display = "block";
              visibleCount++;
            } else {
              card.style.display = "none";
            }
          } else {
            card.style.display = "none";
          }
        });

        if (filter !== "all" && visibleCount > 0) {
          filterCount.style.display = "block";
          filterCount.textContent = visibleCount;
        } else {
          filterCount.style.display = "none";
        }
      }

      // Search functionality
      searchBox.addEventListener("input", function () {
        const searchTerm = this.value.toLowerCase();
        const announcementCards =
          document.querySelectorAll(".announcement-card");

        announcementCards.forEach((card) => {
          const title = card
            .querySelector(".announcement-title")
            .textContent.toLowerCase();
          const description = card
            .querySelector(".announcement-description")
            .textContent.toLowerCase();

          if (title.includes(searchTerm) || description.includes(searchTerm)) {
            card.style.display = "block";
          } else {
            card.style.display = "none";
          }
        });
      });

      // Go back to index.html
      function goBack() {
        window.location.href = "index.html";
      }

      // Load more announcements
      function loadMore() {
        const grid = document.getElementById("announcementsGrid");
        const proposals = loadProposals();

        // Sample additional announcements
        const newAnnouncements = [
          {
            id: Date.now(),
            title: "Community Engagement Research Program - Now Open",
            description:
              "Research projects that address community needs and promote social impact through academic collaboration",
            startDate: "2025-09-01",
            endDate: "2025-10-30",
            status: "active",
            dateCreated: new Date("2025-01-05T14:30:00").toISOString(),
            labelType: "previous",
          },
          {
            id: Date.now() + 1,
            title: "Health Sciences Research Grant - Applications Closed",
            description:
              "This funding opportunity for medical and health-related research projects has now closed",
            startDate: "2025-08-28",
            endDate: "2025-09-01",
            status: "closed",
            dateCreated: new Date("2025-01-01T10:00:00").toISOString(),
            labelType: "previous",
          },
        ];

        newAnnouncements.forEach((announcement, index) => {
          const card = createAnnouncementCard(
            announcement,
            proposals.length + index
          );
          grid.appendChild(card);
        });

        document.querySelector(".load-more-btn").textContent =
          "All announcements loaded";
        document.querySelector(".load-more-btn").disabled = true;
      }

      // Open detail modal
      function openDetailModal(card) {
        const title = card.querySelector(".announcement-title").textContent;
        const description = card.querySelector(
          ".announcement-description"
        ).textContent;
        const date = card.querySelector(".announcement-date").textContent;
        const deadline = card.querySelector(".meta-item span").textContent;
        const status = card.dataset.status;

        document.getElementById("modalTitleText").textContent = title;
        document.getElementById("modalDescription").textContent = description;
        document.getElementById("modalDate").textContent = date;
        document.getElementById("modalDeadline").textContent = deadline;
        document.getElementById("modalStatus").textContent =
          status.charAt(0).toUpperCase() + status.slice(1);

        detailModal.classList.add("show");
      }

      // Close modal function
      function closeModal() {
        detailModal.classList.remove("show");
      }

      // Close modal event listeners
      closeDetailModalBtn.addEventListener("click", closeModal);

      detailModal.addEventListener("click", function (e) {
        if (e.target === this) {
          closeModal();
        }
      });

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        generateAnnouncementCards();
        filterAnnouncements("all");
      });

      // Keyboard navigation
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          closeModal();
        }
      });

      // Listen for storage changes (from index.html)
      window.addEventListener("storage", function (e) {
        if (e.key === PROPOSALS_STORAGE_KEY) {
          generateAnnouncementCards();
        }
      });
    </script>
  </body>
</html>
